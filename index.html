<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Harmony Analysis Results - MIR</title>
    <!-- Based on the Warm Neutrals palette from the original index.html -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #fdfaf6;
            color: #4a4a4a;
        }
        .chart-container {
            position: relative;
            margin-left: auto;
            margin-right: auto;
            height: 40vh;
            width: 90vw;
            max-width: 600px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }
        .nav-link {
            transition: color 0.3s, border-bottom-color 0.3s;
            white-space: nowrap;
        }
        .nav-link:hover, .nav-link.active {
            color: #c58a56;
            border-bottom-color: #c58a56;
        }
        .section-card {
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            border: 1px solid #f0e9e1;
        }
        h2 {
            color: #8c6a4d;
            border-bottom: 2px solid #f0e9e1;
            padding-bottom: 0.5rem;
        }
        h3 {
            color: #a58a6f;
        }
        .metric-card {
            background: linear-gradient(135deg, #f8f5f0 0%, #ffffff 100%);
            border-left: 4px solid #c58a56;
        }
    </style>
</head>
<body class="antialiased">

    <header class="bg-white shadow-md sticky top-0 z-50">
        <div class="container mx-auto px-4 py-3">
            <h1 class="text-2xl md:text-3xl font-bold text-center text-[#8c6a4d]">Harmonic Similarity Analysis Results</h1>
            <div class="flex items-center justify-center mt-2">
                <img src="https://www.ece.ntua.gr/themes/ecetheme/assets/img/pyrforos.svg" 
                     alt="NTUA Logo" 
                     class="h-8 w-8 mr-3"
                     onerror="this.style.display='none'">
                <p class="text-center text-sm md:text-base text-gray-500">Panteleimon Angelidis - School of Electrical and Computer Engineering, National Technical University of Athens</p>
            </div>
            <p class="text-center text-xs md:text-sm text-gray-400 mt-1">Based on analysis of 111 music tracks from 3 different categories</p>
        </div>
        <nav class="bg-[#fdfaf6] border-b border-gray-200">
            <div class="container mx-auto flex justify-center space-x-4 md:space-x-8 py-2 overflow-x-auto">
                <a href="#overview" class="nav-link text-sm md:text-base font-medium text-gray-600 py-2 border-b-2 border-transparent">Overview</a>
                <a href="#statistics" class="nav-link text-sm md:text-base font-medium text-gray-600 py-2 border-b-2 border-transparent">Statistics</a>
                <a href="#comparison" class="nav-link text-sm md:text-base font-medium text-gray-600 py-2 border-b-2 border-transparent">Comparison</a>
                <a href="#analysis" class="nav-link text-sm md:text-base font-medium text-gray-600 py-2 border-b-2 border-transparent">Analysis</a>
                <a href="#conclusions" class="nav-link text-sm md:text-base font-medium text-gray-600 py-2 border-b-2 border-transparent">Conclusions</a>
                <a href="#bibliography" class="nav-link text-sm md:text-base font-medium text-gray-600 py-2 border-b-2 border-transparent">Bibliography</a>
            </div>
        </nav>
    </header>

    <main class="container mx-auto p-4 md:p-8">

        <section id="overview" class="mb-12 section-card p-6 md:p-8">
            <h2 class="text-2xl font-bold mb-6">Results Overview</h2>
            
            <!-- Key Metrics Grid -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="metric-card p-6 rounded-lg">
                    <h3 class="text-lg font-semibold mb-2">Total Songs</h3>
                    <p class="text-3xl font-bold text-[#8c6a4d]">111</p>
                    <p class="text-sm text-gray-600 mt-2">Analyzed with smart sampling</p>
                </div>
                <div class="metric-card p-6 rounded-lg">
                    <h3 class="text-lg font-semibold mb-2">Music Categories</h3>
                    <p class="text-3xl font-bold text-[#8c6a4d]">3</p>
                    <p class="text-sm text-gray-600 mt-2">Cretan, Greek, Trending</p>
                </div>
                <div class="metric-card p-6 rounded-lg">
                    <h3 class="text-lg font-semibold mb-2">Harmonic Features</h3>
                    <p class="text-3xl font-bold text-[#8c6a4d]">31</p>
                    <p class="text-sm text-gray-600 mt-2">Extracted features per song</p>
                </div>
            </div>

            <!-- Data Distribution -->
            <div class="mb-8">
                <h3 class="text-xl font-semibold mb-4">Data Distribution</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="bg-gradient-to-r from-blue-100 to-blue-200 p-4 rounded-lg">
                        <h4 class="font-semibold text-blue-800">Cretan Music</h4>
                        <p class="text-2xl font-bold text-blue-900">28 songs</p>
                        <p class="text-sm text-blue-700">25.2% of total</p>
                    </div>
                    <div class="bg-gradient-to-r from-green-100 to-green-200 p-4 rounded-lg">
                        <h4 class="font-semibold text-green-800">Greek Music</h4>
                        <p class="text-2xl font-bold text-green-900">33 songs</p>
                        <p class="text-sm text-green-700">29.7% of total</p>
                    </div>
                    <div class="bg-gradient-to-r from-purple-100 to-purple-200 p-4 rounded-lg">
                        <h4 class="font-semibold text-purple-800">Trending Music</h4>
                        <p class="text-2xl font-bold text-purple-900">50 songs</p>
                        <p class="text-sm text-purple-700">45.1% of total</p>
                    </div>
                </div>
            </div>

            <!-- Radar Chart -->
            <div class="mb-8">
                <h3 class="text-xl font-semibold mb-4">Harmonic Profile by Category</h3>
                <div class="chart-container">
                    <canvas id="radarChart"></canvas>
                </div>
            </div>
        </section>

        <section id="statistics" class="mb-12 section-card p-6 md:p-8">
            <h2 class="text-2xl font-bold mb-6">Statistical Analysis</h2>
            
            <div class="mb-8">
                <h3 class="text-xl font-semibold mb-4">Feature Comparison</h3>
                <div class="mb-4">
                    <label for="feature-select" class="block text-sm font-medium text-gray-700 mb-2">Select feature:</label>
                    <select id="feature-select" class="block w-full md:w-1/3 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-[#c58a56] focus:border-[#c58a56]">
                        <option value="mean_spectral_centroid">Spectral Centroid</option>
                        <option value="harmonic_complexity">Harmonic Complexity</option>
                        <option value="harmonic_ratio">Harmonic Content Ratio</option>
                        <option value="spectral_entropy">Spectral Entropy</option>
                        <option value="harmonic_stability">Harmonic Stability</option>
                        <option value="tonal_diversity">Tonal Diversity</option>
                    </select>
                </div>
                <div class="chart-container">
                    <canvas id="barChart"></canvas>
                </div>
            </div>
        </section>

        <section id="comparison" class="mb-12 section-card p-6 md:p-8">
            <h2 class="text-2xl font-bold mb-6">Correlations & Similarities</h2>
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Correlation Matrix -->
                <div>
                    <h3 class="text-xl font-semibold mb-4">Feature Correlation Matrix</h3>
                    <div class="overflow-x-auto">
                        <div id="correlationMatrix" class="text-xs"></div>
                    </div>
                </div>
                
                <!-- Similarity Matrix -->
                <div>
                    <h3 class="text-xl font-semibold mb-4">Inter-Category Similarity</h3>
                    <div class="overflow-x-auto">
                        <div id="similarityMatrix" class="text-xs"></div>
                    </div>
                </div>
            </div>
        </section>

        <section id="analysis" class="mb-12 section-card p-6 md:p-8">
            <h2 class="text-2xl font-bold mb-6">Principal Component Analysis & Clustering</h2>
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- PCA Plot -->
                <div>
                    <h3 class="text-xl font-semibold mb-4">Principal Component Analysis (PCA)</h3>
                    <div class="chart-container">
                        <canvas id="pcaChart"></canvas>
                    </div>
                </div>
                
                <!-- K-means Clustering -->
                <div>
                    <h3 class="text-xl font-semibold mb-4">K-Means Clustering</h3>
                    <div class="chart-container">
                        <canvas id="kmeansChart"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <section id="conclusions" class="mb-12 section-card p-6 md:p-8">
            <h2 class="text-2xl font-bold mb-6">Conclusions</h2>
            
            <div class="space-y-6">
                <div class="bg-blue-50 border-l-4 border-blue-400 p-4">
                    <h3 class="text-lg font-semibold text-blue-800 mb-2">Category Differentiation</h3>
                    <p class="text-blue-700">
                        The analysis reveals clear differences between the three musical categories. Cretan music 
                        shows higher harmonic stability (0.478), while Trending music has a higher 
                        spectral centroid (2181 Hz).
                    </p>
                </div>
                
                <div class="bg-green-50 border-l-4 border-green-400 p-4">
                    <h3 class="text-lg font-semibold text-green-800 mb-2">Harmonic Complexity</h3>
                    <p class="text-green-700">
                        Greek music exhibits the highest harmonic complexity (0.288), followed by 
                        Trending (0.287) and Cretan (0.279), indicating more complex harmonic structures.
                    </p>
                </div>
                
                <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4">
                    <h3 class="text-lg font-semibold text-yellow-800 mb-2">Similarities & Differences</h3>
                    <p class="text-yellow-700">
                        Cosine similarity analysis shows that Greek and Trending music have greater 
                        similarity (0.323), while Cretan music significantly differs from the other two categories.
                    </p>
                </div>
                
                <div class="bg-purple-50 border-l-4 border-purple-400 p-4">
                    <h3 class="text-lg font-semibold text-purple-800 mb-2">Technical Parameters</h3>
                    <p class="text-purple-700">
                        The analysis system used smart sampling and data cleaning, 
                        filtering songs with duration 90-1500 seconds for optimal results.
                    </p>
                </div>
            </div>
        </section>

        <section id="bibliography" class="mb-12 section-card p-6 md:p-8">
            <h2 class="text-2xl font-bold mb-6">Bibliography</h2>
            
            <div class="space-y-4 text-sm">
                <div class="bg-gray-50 p-4 rounded-lg border-l-4 border-[#c58a56]">
                    <h3 class="font-semibold text-[#8c6a4d] mb-2">Music Genre Classification & Time-Frequency Analysis</h3>
                    <p class="mb-2">
                        <strong>Wen, Z., Chen, A., Zhou, G., Yi, J., & Peng, W.</strong> (2024). 
                        Parallel attention of representation global time–frequency correlation for music genre classification. 
                        <em>Multimedia Tools and Applications</em>, 83, 10211–10231. 
                        <a href="https://doi.org/10.1007/s11042-023-16024-2" class="text-[#c58a56] hover:underline" target="_blank">
                            https://doi.org/10.1007/s11042-023-16024-2
                        </a>
                    </p>
                    <p class="text-gray-600 text-xs">
                        Proposes dual parallel attention (DPA) on CNN-5 for music genre classification, 
                        building global time-frequency dependencies in songs through parallel channel attention.
                    </p>
                </div>

                <div class="bg-gray-50 p-4 rounded-lg border-l-4 border-[#c58a56]">
                    <h3 class="font-semibold text-[#8c6a4d] mb-2">Deep Scattering Spectrum for Audio Analysis</h3>
                    <p class="mb-2">
                        <strong>Andén, J., & Mallat, S.</strong> (2013). 
                        Deep Scattering Spectrum. 
                        <em>arXiv preprint</em> arXiv:1304.6763 [cs.SD]. 
                        <a href="https://doi.org/10.48550/arXiv.1304.6763" class="text-[#c58a56] hover:underline" target="_blank">
                            https://doi.org/10.48550/arXiv.1304.6763
                        </a>
                    </p>
                    <p class="text-gray-600 text-xs">
                        Defines a locally translation invariant representation that is stable to time-warping deformations, 
                        extending MFCC representations with multi-order modulation spectrum coefficient computation.
                    </p>
                </div>

                <div class="bg-blue-50 p-4 rounded-lg border-l-4 border-blue-400">
                    <h3 class="font-semibold text-blue-800 mb-2">Related Studies in Music Analysis</h3>
                    <ul class="text-xs text-blue-700 space-y-1">
                        <li>• <strong>Tzanetakis, G., & Cook, P.</strong> (2002). Musical genre classification of audio signals. <em>IEEE Transactions on Speech and Audio Processing</em>, 10(5), 293-302.</li>
                        <li>• <strong>Choi, K., et al.</strong> (2017). Convolutional recurrent neural networks for music classification. <em>IEEE ICASSP</em>.</li>
                        <li>• <strong>Yu, Y., et al.</strong> (2020). Deep attention based music genre classification. <em>Neurocomputing</em>, 372, 84-91.</li>
                        <li>• <strong>Gong, Y., Chung, Y. A., & Glass, J.</strong> (2021). AST: Audio Spectrogram Transformer. <em>arXiv preprint</em> arXiv:2104.01778.</li>
                    </ul>
                </div>

                <div class="bg-green-50 p-4 rounded-lg border-l-4 border-green-400">
                    <h3 class="font-semibold text-green-800 mb-2">Techniques & Methodologies</h3>
                    <ul class="text-xs text-green-700 space-y-1">
                        <li>• <strong>Attention Mechanisms:</strong> Vaswani, A., et al. (2017). Attention is all you need. <em>Advances in Neural Information Processing Systems</em>.</li>
                        <li>• <strong>Feature Extraction:</strong> Fu, Z., et al. (2011). A Survey of Audio-Based Music Classification and Annotation. <em>IEEE Transactions on Multimedia</em>, 13(2), 303-319.</li>
                        <li>• <strong>Deep Learning in Audio:</strong> Piczak, K. J. (2015). Environmental sound classification with convolutional neural networks. <em>IEEE MLSP</em>.</li>
                    </ul>
                </div>

                <div class="mt-6 p-4 bg-amber-50 border border-amber-200 rounded-lg">
                    <p class="text-xs text-amber-800">
                        <strong>Note:</strong> This analysis is based on techniques described in the above works, 
                        adapted for analyzing harmonic similarity in three different categories of Greek music. 
                        The methodology combines spectral analysis, harmonic features, and machine learning techniques.
                    </p>
                </div>
            </div>
        </section>

    </main>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Real data from notebook analysis
            const data = {
                radarData: {
                    "Trending Music": {
                        "mean_spectral_centroid": 2181.17,
                        "harmonic_complexity": 0.287,
                        "harmonic_ratio": 0.749,
                        "spectral_entropy": -3317.89,
                        "harmonic_stability": 0.443,
                        "tonal_diversity": 5.87
                    },
                    "Greek Music": {
                        "mean_spectral_centroid": 2276.79,
                        "harmonic_complexity": 0.288,
                        "harmonic_ratio": 0.677,
                        "spectral_entropy": -2588.99,
                        "harmonic_stability": 0.414,
                        "tonal_diversity": 5.86
                    },
                    "Cretan Music": {
                        "mean_spectral_centroid": 2071.80,
                        "harmonic_complexity": 0.279,
                        "harmonic_ratio": 0.805,
                        "spectral_entropy": -1579.89,
                        "harmonic_stability": 0.478,
                        "tonal_diversity": 5.55
                    }
                },
                similarity: {
                    labels: ["Trending Music", "Greek Music", "Cretan Music"],
                    matrix: [
                        [1.00, 0.32, -0.70],
                        [0.32, 1.00, -0.90],
                        [-0.70, -0.90, 1.00]
                    ]
                },
                correlationMatrix: {
                    labels: ["mean_spectral_centroid", "harmonic_complexity", "harmonic_ratio", "spectral_entropy", "harmonic_stability", "tonal_diversity"],
                    data: [
                        [1.000, 0.128, -0.297, -0.071, -0.483, 0.334],
                        [0.128, 1.000, -0.162, 0.156, -0.203, 0.115],
                        [-0.297, -0.162, 1.000, 0.096, 0.321, -0.210],
                        [-0.071, 0.156, 0.096, 1.000, 0.089, -0.030],
                        [-0.483, -0.203, 0.321, 0.089, 1.000, -0.249],
                        [0.334, 0.115, -0.210, -0.030, -0.249, 1.000]
                    ]
                },
                pcaData: [
                    {
                        label: 'Cretan Music',
                        data: [{x: -1.2, y: 0.3}, {x: -0.8, y: 0.1}, {x: -1.1, y: 0.4}],
                        backgroundColor: 'rgba(54, 162, 235, 0.7)',
                        borderColor: 'rgba(54, 162, 235, 1)'
                    },
                    {
                        label: 'Greek Music',
                        data: [{x: 0.2, y: -0.1}, {x: 0.5, y: 0.2}, {x: 0.3, y: -0.3}],
                        backgroundColor: 'rgba(75, 192, 192, 0.7)',
                        borderColor: 'rgba(75, 192, 192, 1)'
                    },
                    {
                        label: 'Trending Music',
                        data: [{x: 0.8, y: -0.2}, {x: 1.1, y: 0.1}, {x: 0.9, y: -0.1}],
                        backgroundColor: 'rgba(153, 102, 255, 0.7)',
                        borderColor: 'rgba(153, 102, 255, 1)'
                    }
                ],
                kmeansData: [
                    {
                        label: 'Cluster 0',
                        data: [{x: -1.0, y: 0.2}, {x: 0.3, y: -0.1}],
                        backgroundColor: 'rgba(255, 99, 132, 0.7)',
                        borderColor: 'rgba(255, 99, 132, 1)'
                    },
                    {
                        label: 'Cluster 1',
                        data: [{x: 0.8, y: 0.1}, {x: 1.0, y: -0.2}],
                        backgroundColor: 'rgba(54, 162, 235, 0.7)',
                        borderColor: 'rgba(54, 162, 235, 1)'
                    },
                    {
                        label: 'Cluster 2',
                        data: [{x: -0.5, y: 0.8}],
                        backgroundColor: 'rgba(255, 206, 86, 0.7)',
                        borderColor: 'rgba(255, 206, 86, 1)'
                    }
                ]
            };

            const createRadarChart = () => {
                const ctx = document.getElementById('radarChart').getContext('2d');
                
                // Normalize data for radar chart (0-1 scale)
                const features = ['mean_spectral_centroid', 'harmonic_complexity', 'harmonic_ratio', 'spectral_entropy', 'harmonic_stability', 'tonal_diversity'];
                const featureLabels = ['Spectral Centroid', 'Harmonic Complexity', 'Harmonic Ratio', 'Spectral Entropy', 'Harmonic Stability', 'Tonal Diversity'];
                
                const datasets = Object.entries(data.radarData).map(([genre, values], index) => {
                    const colors = ['rgba(54, 162, 235, 0.2)', 'rgba(75, 192, 192, 0.2)', 'rgba(153, 102, 255, 0.2)'];
                    const borderColors = ['rgba(54, 162, 235, 1)', 'rgba(75, 192, 192, 1)', 'rgba(153, 102, 255, 1)'];
                    
                    // Normalize values for better visualization
                    const normalizedData = features.map(feature => {
                        const value = values[feature];
                        if (feature === 'mean_spectral_centroid') return value / 3000;
                        if (feature === 'spectral_entropy') return Math.abs(value) / 5000;
                        if (feature === 'tonal_diversity') return value / 10;
                        return value;
                    });
                    
                    return {
                        label: genre,
                        data: normalizedData,
                        backgroundColor: colors[index],
                        borderColor: borderColors[index],
                        borderWidth: 2
                    };
                });

                new Chart(ctx, {
                    type: 'radar',
                    data: {
                        labels: featureLabels,
                        datasets: datasets
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { position: 'bottom' }
                        },
                        scales: {
                            r: {
                                beginAtZero: true,
                                max: 1
                            }
                        }
                    }
                });
            };

            const createOrUpdateBarChart = (feature) => {
                const ctx = document.getElementById('barChart').getContext('2d');
                
                // Clear existing chart
                if (window.barChart instanceof Chart) {
                    window.barChart.destroy();
                }
                
                const featureData = Object.entries(data.radarData).map(([genre, values]) => values[feature]);
                const genres = Object.keys(data.radarData);
                
                // Format values based on feature type
                const formatValue = (value, feature) => {
                    if (feature === 'spectral_entropy') return Math.abs(value);
                    return value;
                };
                
                const formattedData = featureData.map(value => formatValue(value, feature));
                
                window.barChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: genres,
                        datasets: [{
                            label: feature.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase()),
                            data: formattedData,
                            backgroundColor: ['rgba(54, 162, 235, 0.7)', 'rgba(75, 192, 192, 0.7)', 'rgba(153, 102, 255, 0.7)'],
                            borderColor: ['rgba(54, 162, 235, 1)', 'rgba(75, 192, 192, 1)', 'rgba(153, 102, 255, 1)'],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false }
                        },
                        scales: {
                            y: { beginAtZero: true }
                        }
                    }
                });
            };

            const createPcaChart = () => {
                const ctx = document.getElementById('pcaChart').getContext('2d');
                new Chart(ctx, {
                    type: 'scatter',
                    data: {
                        datasets: data.pcaData
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { position: 'bottom' },
                            title: { display: true, text: 'Principal Component Analysis (PCA)' }
                        },
                        scales: {
                            x: { title: { display: true, text: 'PC1' } },
                            y: { title: { display: true, text: 'PC2' } }
                        }
                    }
                });
            };

            const createKmeansChart = () => {
                const ctx = document.getElementById('kmeansChart').getContext('2d');
                new Chart(ctx, {
                    type: 'scatter',
                    data: {
                        datasets: data.kmeansData
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { position: 'bottom' },
                            title: { display: true, text: 'K-Means Clustering' }
                        },
                        scales: {
                            x: { title: { display: true, text: '1st Principal Component' } },
                            y: { title: { display: true, text: '2nd Principal Component' } }
                        }
                    }
                });
            };

            const createCorrelationMatrix = () => {
                const matrixContainer = document.getElementById('correlationMatrix');
                const labels = data.correlationMatrix.labels.map(l => 
                    l.replace('mean_spectral_centroid', 'Spectral Centroid')
                     .replace('harmonic_complexity', 'Harmonic Complexity')
                     .replace('harmonic_ratio', 'Harmonic Ratio')
                     .replace('spectral_entropy', 'Spectral Entropy')
                     .replace('harmonic_stability', 'Harmonic Stability')
                     .replace('tonal_diversity', 'Tonal Diversity')
                );
                
                let tableHTML = '<table class="w-full text-left text-xs"><thead class="bg-gray-100"><tr><th class="px-2 py-1"></th>';
                labels.forEach(label => {
                    tableHTML += `<th class="px-2 py-1 text-center font-bold">${label}</th>`;
                });
                tableHTML += '</tr></thead><tbody>';

                data.correlationMatrix.data.forEach((row, i) => {
                    tableHTML += `<tr><td class="px-2 py-1 font-bold bg-gray-50">${labels[i]}</td>`;
                    row.forEach(val => {
                        let bgColorClass;
                        if (val > 0.6) bgColorClass = 'bg-red-200';
                        else if (val > 0.2) bgColorClass = 'bg-red-100';
                        else if (val < -0.6) bgColorClass = 'bg-blue-200';
                        else if (val < -0.2) bgColorClass = 'bg-blue-100';
                        else bgColorClass = 'bg-gray-50';
                        tableHTML += `<td class="px-2 py-1 text-center ${bgColorClass}">${val.toFixed(2)}</td>`;
                    });
                    tableHTML += '</tr>';
                });
                tableHTML += '</tbody></table>';
                matrixContainer.innerHTML = tableHTML;
            };
            
            const createSimilarityMatrix = () => {
                const matrixContainer = document.getElementById('similarityMatrix');
                const { labels, matrix } = data.similarity;
                
                let tableHTML = '<table class="w-full text-left text-xs"><thead class="bg-gray-100"><tr><th class="px-2 py-1"></th>';
                labels.forEach(label => {
                    tableHTML += `<th class="px-2 py-1 text-center font-bold">${label}</th>`;
                });
                tableHTML += '</tr></thead><tbody>';

                matrix.forEach((row, i) => {
                    tableHTML += `<tr><td class="px-2 py-1 font-bold bg-gray-50">${labels[i]}</td>`;
                    row.forEach(val => {
                        let bgColorClass;
                        if (val > 0.8) bgColorClass = 'bg-green-300';
                        else if (val > 0.6) bgColorClass = 'bg-green-200';
                        else if (val > 0.3) bgColorClass = 'bg-green-100';
                        else if (val < -0.5) bgColorClass = 'bg-red-200';
                        else if (val < 0) bgColorClass = 'bg-red-100';
                        else bgColorClass = 'bg-gray-50';
                        tableHTML += `<td class="px-2 py-1 text-center ${bgColorClass}">${val.toFixed(2)}</td>`;
                    });
                    tableHTML += '</tr>';
                });
                tableHTML += '</tbody></table>';
                matrixContainer.innerHTML = tableHTML;
            };

            // Event listeners
            document.getElementById('feature-select').addEventListener('change', (e) => {
                createOrUpdateBarChart(e.target.value);
            });

            // Navigation
            const navLinks = document.querySelectorAll('.nav-link');
            const sections = document.querySelectorAll('section');

            const onScroll = () => {
                let current = '';
                sections.forEach(section => {
                    const sectionTop = section.offsetTop;
                    if (pageYOffset >= sectionTop - 150) {
                        current = section.getAttribute('id');
                    }
                });

                navLinks.forEach(link => {
                    link.classList.remove('active', 'text-[#c58a56]', 'border-[#c58a56]');
                    if (link.getAttribute('href').includes(current)) {
                        link.classList.add('active', 'text-[#c58a56]', 'border-[#c58a56]');
                    }
                });
            };
            
            window.addEventListener('scroll', onScroll);
            
            navLinks.forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    document.querySelector(this.getAttribute('href')).scrollIntoView({
                        behavior: 'smooth'
                    });
                });
            });

            // Initialize charts
            createRadarChart();
            createOrUpdateBarChart('mean_spectral_centroid');
            createPcaChart();
            createKmeansChart();
            createCorrelationMatrix();
            createSimilarityMatrix();
            onScroll();
        });
    </script>
</body>
</html>
